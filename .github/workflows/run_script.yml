name: Run Scraper

on:
  schedule:
    - cron: "*/5 6-18 * * *"  # Ù‡Ø± 5 Ø¯Ù‚ÛŒÙ‚Ù‡ Ø§Ø² Ø³Ø§Ø¹Øª 6 ØµØ¨Ø­ ØªØ§ 6 Ø¹ØµØ± Ø§Ø¬Ø±Ø§ Ù…ÛŒâ€ŒØ´ÙˆØ¯
  workflow_dispatch:  # Ø§ÛŒÙ† Ù…ÙˆØ±Ø¯ Ø¨Ù‡ Ø´Ù…Ø§ Ø§Ù…Ú©Ø§Ù† Ù…ÛŒâ€ŒØ¯Ù‡Ø¯ Ø¨Ù‡â€ŒØµÙˆØ±Øª Ø¯Ø³ØªÛŒ Ù‡Ù… Ø§Ø¬Ø±Ø§ Ú©Ù†ÛŒØ¯

jobs:
  scraper:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Set up Python
      uses: actions/setup-python@v2
      with:
        python-version: '3.9'  # Ù†Ø³Ø®Ù‡ Ù¾Ø§ÛŒØªÙˆÙ† Ø±Ø§ Ù…ØªÙ†Ø§Ø³Ø¨ Ø¨Ø§ Ù†ÛŒØ§Ø² Ø®ÙˆØ¯ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt  # Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø­Ø§ØµÙ„ Ú©Ù†ÛŒØ¯ Ú©Ù‡ ØªÙ…Ø§Ù… ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§ Ø¯Ø± requirements.txt Ù‡Ø³ØªÙ†Ø¯

    - name: Run scraper
      run: |
        python main.py  # Ù†Ø§Ù… ÙØ§ÛŒÙ„ Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù‡ Ø¬Ø§ÛŒ main.py Ø¨Ú¯Ø°Ø§Ø±ÛŒØ¯
      env:
        BOT_TOKEN: ${{ secrets.BOT_TOKEN }}
        CHAT_ID: ${{ secrets.CHAT_ID }}

    - name: Set up GitHub token
      run: git config --global credential.helper store
      env:
        GH_TOKEN: ${{ secrets.GH_TOKEN }}

    - name: Commit and push updated message_ids.json
      run: |
        git config --global user.email "bot@github.com"
        git config --global user.name "AutoBot"
        git add data/message_ids.json
        git commit -m "ğŸ” Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ message_ids.json"
        git push
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
