name: Run Python Scraper

on:
  # 1. اجرای دستی از طریق صفحه Actions در گیت‌هاب
  workflow_dispatch:

  # 2. اجرای زمان‌بندی شده (مثلاً هر 6 ساعت)
  schedule:
    - cron: '0 */6 * * *'

  # 3. اجرای خودکار هنگام پوش کردن تغییرات در فایل main.py (بخش جدید)
  # <<< این بخش جدید و کلیدی است >>>
  push:
    branches:
      - main  # یا 'master' اگر نام شاخه اصلی شما این است
    paths:
      - 'main.py'
  # <<< پایان بخش جدید >>>

jobs:
  scrape_and_update:
    runs-on: ubuntu-latest

    steps:
      - name: Check out repository
        uses: actions/checkout@v3

      - name: Set up Google Chrome
        uses: browser-actions/setup-chrome@v1

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.8'

      - name: Install Python dependencies
        run: |
          python -m pip install --upgrade pip
          pip install selenium beautifulsoup4 requests selenium-stealth

      - name: Run scraper script
        env:
          # این کلیدها از بخش Secrets ریپازیتوری شما خوانده می‌شوند
          # مطمئن شوید که WC_API_URL, WC_CONSUMER_KEY, WC_CONSUMER_SECRET را در Secrets تعریف کرده‌اید
          WC_API_URL: ${{ secrets.WC_API_URL }}
          WC_CONSUMER_KEY: ${{ secrets.WC_CONSUMER_KEY }}
          WC_CONSUMER_SECRET: ${{ secrets.WC_CONSUMER_SECRET }}
        run: python main.py
